# Interpretable Poetry Classification

این مخزن شامل کدها و فایل‌های لازم برای اجرای پروژه‌ی «تفسیرپذیری و طبقه‌بندی موضوعی شعر فارسی و انگلیسی با استفاده از مدل‌های زبانی بزرگ» است. هدف پروژه دسته‌بندی شعرها به چهار دسته‌ی احساس‌محور ــ «عشق»، «فلسفه»، «روحانیت» و «مرگ» ــ و تحلیل نحوه‌ی پردازش مفاهیم فرهنگی فارسی توسط مدل‌های چندزبانه است.

## ساختار مخزن

```
poetry_llm_repo/
├── dataset/
│   └── poems.csv            # نمونه‌ای کوچک از داده‌ی شعر با برچسب و زبان
├── src/
│   ├── dataset_utils.py     # توابع بارگذاری و پیش‌پردازش داده
│   ├── finetune_lora.py     # اسکریپت آموزش مدل با LoRA
│   ├── interpretability.py  # پیاده‌سازی روش‌های تفسیرپذیری
│   └── (سایر فایل‌ها)
├── requirements.txt         # لیست وابستگی‌های پایتونی
└── README.md                # این فایل
```

### داده‌ها

فایل `dataset/poems.csv` شامل چند نمونه شعر فارسی و انگلیسی به همراه برچسب احساسی و زبان است. در پروژه‌ی واقعی باید مجموعه‌ی داده‌ی کامل و متوازن از شعرهای کلاسیک و معاصر فارسی و انگلیسی تهیه شود. برای افزودن داده‌های جدید، کافی است فایل را مطابق با ساختار فعلی (ستون‌های `text`, `label`, `language`) گسترش دهید. در ماژول `dataset_utils.py` توابعی برای پاک‌سازی متن و تقسیم داده به بخش‌های آموزش و اعتبارسنجی در نظر گرفته شده است.

### آموزش خط مبنا (Baseline)

برای ارزیابی اولیه می‌توانید با استفاده از مدل‌های ساده‌ی یادگیری ماشین یا یک مدل زبانی کوچک طبقه‌بندی انجام دهید. فایل `finetune_lora.py` یک اسکریپت کامل برای آموزش مدل‌های زبانی بزرگ با استفاده از LoRA فراهم می‌کند. این اسکریپت به کتابخانه‌های خارجی مانند `transformers`، `peft` و `bitsandbytes` نیاز دارد. جهت اجرا:

```bash
# نصب وابستگی‌ها
pip install -r requirements.txt

# اجرای آموزش با LoRA روی داده‌های فارسی
python src/finetune_lora.py --dataset dataset/poems.csv --language persian --output_dir outputs/lora-persian

# برای آموزش روی داده‌های انگلیسی
python src/finetune_lora.py --dataset dataset/poems.csv --language english --output_dir outputs/lora-english
```

در این اسکریپت از مدل `google/gemma-2b-it` به عنوان مدل پایه استفاده شده است. به دلیل محدودیت‌های سخت‌افزاری، توصیه می‌شود از نسخه‌های کوچک‌تر (مانند `gemma-1.1b-it` یا `bigscience/bloomz-560m`) استفاده کنید یا مدل مورد نیاز خود را تغییر دهید. تمامی وزن‌های اصلی مدل فریز می‌شوند و تنها آداپتورهای LoRA آموزش داده می‌شوند.

### روش‌های تفسیرپذیری

در فایل `interpretability.py` سه تکنیک اصلی تفسیرپذیری پیاده‌سازی شده است:

1. **Logit Lens** – به‌کمک این روش می‌توان مشاهده کرد که در هر لایه از مدل، احتمال اختصاص داده شده به برچسب‌های مختلف چگونه تغییر می‌کند. تابع `logit_lens_analysis` ورودی یک شعر و شناسه‌ی توکن هر برچسب را دریافت می‌کند و میانگین لاجیت برچسب را برای هر لایه محاسبه می‌کند.

2. **Activation Patching** – با تابع `activation_patch` می‌توانید خروجی لایه‌های میانی یک شعر انگلیسی را در مدل وارد شعر فارسی کنید و تغییر ایجادشده در لاجیت نهایی را اندازه بگیرید. این روش برای یافتن «لایه‌های بحرانی» که بیشترین نقش را در تشخیص احساس دارند کاربرد دارد.

3. **Steering Vectors** – با استفاده از تابع `compute_steering_vector` می‌توان تفاوت میانگین نمایش‌های پنهان شعرهای فارسی و انگلیسی را به‌عنوان برداری محاسبه کرد و سپس آن را به لایه‌ی بحرانی افزود تا مدل به سمت درک بهتر مفاهیم فرهنگی فارسی هدایت شود.

این کدها نمونه‌ای ساده از تکنیک‌های توضیح‌داده‌شده در گزارش هستند و برای اجرا به مدل‌های سازگار با کتابخانه‌ی Transformers نیاز دارند.

## راهنمای ایجاد مخزن در گیت‌هاب

پس از آماده‌سازی کد و داده‌ها، می‌توانید این پروژه را در حساب گیت‌هاب خود بارگذاری کنید. مراحل زیر را دنبال کنید:

1. **ساخت مخزن جدید در گیت‌هاب:**
   1. به [github.com](https://github.com) وارد شوید و روی دکمه‌ی “New” در بخش مخازن کلیک کنید.
   2. نامی برای مخزن (مثلاً `poetry-interpretability`) انتخاب کنید، توضیح کوتاهی بنویسید و در صورت تمایل حالت عمومی یا خصوصی بودن را تنظیم کنید.
   3. گزینه‌ی ایجاد فایل `README` را انتخاب نکنید (ما در این مخزن فایل README داریم) و روی “Create repository” کلیک کنید.

2. **بارگذاری فایل‌های پروژه:**
   
   روش ساده این است که کد را به صورت زیپ آماده کرده و از طریق رابط وب گیت‌هاب بارگذاری کنید یا از خط فرمان استفاده کنید. در اینجا روش خط فرمان را توضیح می‌دهیم:
   
   ```bash
   # ابتدا به پوشه‌ی پروژه بروید
   cd path/to/poetry_llm_repo

   # مخزن گیت را مقداردهی اولیه کنید
   git init

   # فایل‌های پروژه را به کنترل نسخه اضافه کنید
   git add .

   # یک کامیت اولیه ایجاد کنید
   git commit -m "Initial commit: interpretable poetry classification"

   # مخزن محلی را به مخزن گیت‌هاب وصل کنید (لینک را از صفحه‌ی مخزن کپی کنید)
   git remote add origin https://github.com/USERNAME/poetry-interpretability.git

   # تغییرات را به گیت‌هاب ارسال کنید
   git push -u origin master
   ```

   جایگزین کردن `USERNAME` با نام کاربری خود را فراموش نکنید. پس از اجرای این دستور، گیت از شما نام کاربری و رمز عبور یا توکن دسترسی شخصی (PAT) را خواهد خواست. پس از تأیید هویت، فایل‌ها به مخزن شما ارسال می‌شوند.

3. **بررسی مخزن:** بعد از بارگذاری موفق، صفحه‌ی مخزن گیت‌هاب خود را باز کنید و مطمئن شوید که تمام فایل‌ها (از جمله `src`, `dataset`, و `README.md`) در دسترس هستند.

4. **ایجاد مستندات و شاخه‌های بعدی:** در صورت نیاز می‌توانید پرونده‌های دیگری مانند `LICENSE`، `CONTRIBUTING.md` یا شاخه‌های جدید برای توسعه‌ی ویژگی‌های بعدی اضافه کنید. همچنین با استفاده از بخش Issues و Pull Requests می‌توانید روند توسعه‌ی پروژه را مدیریت کنید.

امیدواریم این مخزن نقطه‌ی شروع خوبی برای توسعه‌ی روش‌های تفسیرپذیر در مدل‌های زبانی بزرگ باشد. هرگونه سؤال یا پیشنهاد را می‌توانید در بخش Issues گیت‌هاب مطرح کنید.